/**
 * Import TOPIK 35 Reading Questions 32-50
 * Run: npx ts-node src/scripts/import-topik35-reading.ts
 */

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

const EXAM_ID = 'topik-35-reading';

const newQuestions = [
    // --- [32~34] 内容一致 ---
    {
        id: 32,
        number: 32,
        passage: "항공사들은 비행기 안에서 먹는 기내식의 맛을 살리기 위해 많은 노력을 한다. 먼저 건조한 기내 환경을 고려하여 음식의 수분이 날아가지 않도록 포장에 신경을 쓴다. 또한 고도가 높아졌을 때 사람들의 미각이 둔해지는 것에 대비해서 일부러 음식을 조금 짜게 만든다. 또 기내식은 미리 조리하여 냉동한 후 비행기에 싣기 때문에 손님들에게 내놓기 직전에 다시 따뜻하게 데운다.",
        question: "이 글의 내용과 같은 것을 고르십시오.",
        options: [
            "기내가 건조해서 사람들의 입맛이 예민해진다.",
            "기내식은 좀 더 짜게 만들어야 맛을 낼 수 있다.",
            "음식 온도를 유지하기 위해 기내식을 포장해 놓는다.",
            "음식에 있는 수분을 줄여 기내식이 상하는 것을 방지한다."
        ],
        correctAnswer: 1, // 기내식은 좀 더 짜게 만들어야...
        score: 2,
        instruction: "※ [32～34] 다음을 읽고 내용이 같은 것을 고르십시오."
    },
    {
        id: 33,
        number: 33,
        passage: "요즘 도시에 벌의 수가 증가하여 이로 인한 피해가 종종 발생하고 있다. 한 연구팀은 도시가 벌이 살기에 적합한 환경이 된 것이 원인이라고 밝혔다. 도시 환경이 벌의 생존에 도움이 된다는 것이다. 도시의 공원에서 다양한 꽃과 식물이 자라고 있어 풍부한 먹이를 제공한다고 한다. 농촌에 비해 도시가 상대적으로 농약 사용이 적어 안전하다는 것도 도시에 벌이 많아진 또 하나의 이유라고 한다.",
        question: "이 글의 내용과 같은 것을 고르십시오.",
        options: [
            "예전에 비해 도시에 사는 벌의 수가 줄었다.",
            "벌을 쫓기 위해 도시의 식물에 약을 뿌리고 있다.",
            "도시의 벌 피해 방지법에 대한 연구가 진행 중이다.",
            "도시의 공원이 벌이 살 수 있는 좋은 환경을 제공한다."
        ],
        correctAnswer: 3, // 도시의 공원이 벌이 살 수 있는...
        score: 2
    },
    {
        id: 34,
        number: 34,
        passage: "정부에서 '휴가 하루 더 가기' 캠페인을 벌이고 있다. 국내 관광의 활성화를 목적으로 기업들과 근로자의 참여를 유도하겠다는 것이다. 국민들의 국내 휴가 일수가 하루 증가하면 소비가 2조 5천억 원이 늘어 경제가 활성화된다. 또 관광업계에 5만 개 이상의 일자리가 생길 것으로 예상된다. 집중력이 떨어질 수 있는 더운 여름철, 근로자들의 사기를 높이는 데에도 도움이 될 것으로 보인다.",
        question: "이 글의 내용과 같은 것을 고르십시오.",
        options: [
            "휴가 기간이 늘어나면 경제에 악영향을 끼친다.",
            "국내 관광업과 관련된 일자리는 5만 개 정도이다.",
            "관광업계에서 이 캠페인을 기획하여 진행하고 있다.",
            "이 캠페인은 국내 관광을 활성화하기 위해 시작되었다."
        ],
        correctAnswer: 3, // 이 캠페인은 국내 관광을 활성화...
        score: 2
    },
    // --- [35~38] 主题选择 ---
    {
        id: 35,
        number: 35,
        passage: "미혼이라는 말에는 결혼은 꼭 해야 하는 것이지만 아직 하지 않았다는 뜻이 포함되어 있다. 그러나 결혼은 필수가 아니라 선택이라고 생각하는 사람들이 증가함에 따라 미혼이라는 말 대신에 결혼을 선택하지 않는다는 의미의 비혼이라는 단어가 사용되기 시작하였다. 미혼, 독신 등의 단어들이 비혼이라는 단어에 자리를 내주게 된 것이다.",
        question: "이 글의 주제로 가장 알맞은 것을 고르십시오.",
        options: [
            "미혼이라는 말은 결혼에 대한 다양한 의미를 포괄한다.",
            "비혼이라는 말은 결혼에 대한 인식의 변화를 보여 준다.",
            "비혼과 미혼은 같은 대상을 가리키므로 의미의 차이는 없다.",
            "미혼이라는 말은 결혼을 계획하는 사람들에게 부적절한 표현이다."
        ],
        correctAnswer: 1, // 비혼이라는 말은 결혼에 대한 인식의 변화...
        score: 2,
        instruction: "※ [35～38] 다음 글의 주제로 가장 알맞은 것을 고르십시오."
    },
    {
        id: 36,
        number: 36,
        passage: "패션도 비즈니스의 일부이다. 비즈니스를 목적으로 누군가를 만나야 한다면 비즈니스 상황에 따라 입고 나갈 옷의 색상, 디자인, 소재 등을 고려하여 전략적으로 이미지를 연출하는 것이 중요하다. 강한 의지를 표명해야 한다면 빳빳한 소재의 무채색 옷을 선택하는 것이 바람직하다. 반면에 상대 회사와 협상을 해야 한다면 광택이 있는 부드러운 소재의 복장을 통해 편안한 분위기를 연출하는 것이 좋다. 상대 회사를 상징하는 색상의 셔츠나 넥타이로 친근감을 표현할 수도 있다.",
        question: "이 글의 주제로 가장 알맞은 것을 고르십시오.",
        options: [
            "회사의 이미지를 비즈니스 패션을 통해 연출하라.",
            "비즈니스 상황에 부합하는 패션 전략을 활용하라.",
            "회사를 상징하는 색상으로 편안한 분위기를 조성하라.",
            "부드러운 이미지 연출을 위한 비즈니스 전략을 세워라."
        ],
        correctAnswer: 1, // 비즈니스 상황에 부합하는 패션 전략을 활용하라
        score: 2
    },
    {
        id: 37,
        number: 37,
        passage: "육체적·정신적 피로로 인해 무기력한 상태가 지속된다면 소진증후군을 의심해 보아야 한다. 이 증후군의 대표적인 증상으로는 심한 불안감, 무기력, 삶에 대한 무관심 등을 들 수 있다. 일단 소진증후군을 앓게 되면 회복이 힘들다는 점을 고려할 때 휴식과 재충전을 통해 심신의 건강을 유지하려는 자세가 요구된다. 평소 작은 일에 기뻐하고 행복해 함으로써 삶의 활력을 유지하는 것도 이 증후군을 예방하는 데 도움이 된다.",
        question: "이 글의 주제로 가장 알맞은 것을 고르십시오.",
        options: [
            "소진증후군이 사회에 미치는 영향을 분석해야 한다.",
            "소진증후군의 원인과 증상의 관계를 파악해야 한다.",
            "소진증후군의 증상에 맞는 치료법을 개발해야 한다.",
            "소진증후군이 발생하지 않도록 사전에 노력해야 한다."
        ],
        correctAnswer: 3, // 소진증후군이 발생하지 않도록 사전에 노력해야 한다
        score: 2
    },
    {
        id: 38,
        number: 38,
        passage: "그동안 로봇이 주로 인간의 육체노동만을 대체해 왔다면 앞으로는 지식 노동까지도 대체하게 될 것이다. 이러한 로봇의 등장으로 사람들은 일자리를 잃게 될지도 모른다는 생각을 할 수도 있다. 그러나 남는 노동 자원을 로봇이 대체할 수 없는 일에 활용할 수 있다는 긍정적인 면도 있다. 예를 들어 기업의 실적이나 스포츠 경기의 결과에 대한 데이터 수집이나 분석과 같은 단순 업무는 '로봇기자'가 담당하고 기자들은 심층 분석이나 인터뷰와 같은 깊이 있는 기사 작성에 더 집중할 수 있게 될 것이다.",
        question: "이 글의 주제로 가장 알맞은 것을 고르십시오.",
        options: [
            "로봇의 등장으로 인간의 지식 노동 시간이 감소하게 될 것이다.",
            "로봇의 등장으로 인간은 육체노동의 시간을 줄일 수 있을 것이다.",
            "로봇의 등장으로 인간의 노동력 시장 규모가 점점 축소될 것이다.",
            "로봇의 등장으로 인간은 질적인 업무에 집중할 수 있게 될 것이다."
        ],
        correctAnswer: 3, // 로봇의 등장으로 인간은 질적인 업무에 집중할 수 있게 될 것이다
        score: 2
    },
    // --- [39~41] 보기 插入 ---
    {
        id: 39,
        number: 39,
        layout: "INSERT_BOX",
        passage: "운전 시 안전과 직결되는 것 중의 하나가 바로 차선이다. ( ㉠ ) 야간 운전 중에 차선이 잘 보이지 않으면 크고 작은 사고들이 발생하게 될 것이다. ( ㉡ ) 반사 성능을 더욱 강화하고자 할 때에는 유리알이 혼합된 페인트를 사용할 수 있다. ( ㉢ ) 이렇게 하면 유리알이 불빛에 반사되어 차선이 더욱 잘 보이게 된다. ( ㉣ )",
        contextBox: "이를 방지하기 위해 야간에 차선이 잘 보이도록 반사 기능이 있는 특수한 페인트를 사용한다.",
        question: "<보기>의 문장이 들어가기에 가장 알맞은 곳을 고르십시오.",
        options: ["㉠", "㉡", "㉢", "㉣"],
        correctAnswer: 1, // ㉡
        score: 2,
        instruction: "※ [39～41] 다음 글에서 <보기>의 문장이 들어가기에 가장 알맞은 곳을 고르십시오."
    },
    {
        id: 40,
        number: 40,
        layout: "INSERT_BOX",
        passage: "부자들을 대상으로 사업체 상속 계획에 대해 조사한 결과 부의 축적 유형에 따라 차이를 보였다. ( ㉠ ) 상속형 부자의 경우 절반 정도가 사업체를 자녀에게 물려주겠다고 응답했다. ( ㉡ ) 반면 자수성가형 부자는 자녀 상속 의향이 20% 정도에 지나지 않았다. ( ㉢ ) 상속형 부자는 자녀에게 기회를 주기 위해 물려준다고 응답한 반면 자수성가형 부자는 기술 및 비법 등을 전수하기 위해서 물려준다고 답했다. ( ㉣ )",
        contextBox: "자녀에게 사업체를 물려주려는 이유에서도 두 집단이 차이를 보였다.",
        question: "<보기>의 문장이 들어가기에 가장 알맞은 곳을 고르십시오.",
        options: ["㉠", "㉡", "㉢", "㉣"],
        correctAnswer: 2, // ㉢
        score: 2
    },
    {
        id: 41,
        number: 41,
        layout: "INSERT_BOX",
        passage: "지난 10년간 '한국형 리더십'에 남다른 관심을 쏟아 온 박선호 박사는 『세종에게서 배우다』라는 신간을 내놓았다. ( ㉠ ) 『세종에게서 배우다』는 세종의 리더십을 배워 잘 활용할 수 있도록 돕는 일종의 경영서이다. ( ㉡ ) 세종은 여러 분야에서 리더로서의 면모를 보여 주었다. 만일 그에게 탁월한 리더십이 없었더라면 한글 창제와 같은 업적은 불가능했을 지도 모른다. ( ㉢ ) 신분이나 지역을 따지지 않고 오직 개인의 역량만을 기준으로 사람을 뽑아 썼다. ( ㉣ )",
        contextBox: "세종의 남다른 리더십은 인재의 등용에서도 잘 나타난다.",
        question: "<보기>의 문장이 들어가기에 가장 알맞은 곳을 고르십시오.",
        options: ["㉠", "㉡", "㉢", "㉣"],
        correctAnswer: 2, // ㉢
        score: 2
    },
    // --- [42~43] 分组阅读 ---
    {
        id: 42,
        number: 42,
        groupCount: 2,
        passage: `초등학교 3학년쯤으로 보이는 남자 아이가 가장 높은 다이빙대에 올라갔다. 성인도 호기로 올라갔다가 그냥 내려오곤 하는 곳이었다. 소년은 무서워서 뛰어내리지도, 뒤돌아 내려가지도 못하고 다이빙대 끝과 계단 사이를 한참 왔다 갔다 했다. 그러자 부모로 보이는 사람이 내려오라는 손짓을 했다. 아이는 계속 망설였다. 수영장의 모든 사람이 이 모습을 지켜보고 있었다. 그때였다. 스피커에서 수영장 관리자로 추정되는 사람의 목소리가 나오기 시작했다. 나는 당연히 아이의 부모에게 '어서 아이를 데리고 내려오라.'고 말할 줄 알았다. 그런데 그는 전혀 다른 말을 했다.

"넌 할 수 있어! 내가 도와줄게. 이제 셋을 셀 거야. 겁내지 말고 뛰어내리면 돼!"

그리고 큰 소리로 숫자를 세기 시작했다. 수영장에 있던 모든 사람도 스피커 소리를 따라 큰 소리로 숫자를 따라 셌다. (중략) 아이는 다이빙대 끝을 박차고 허공에 손을 휘저으며 뛰어내렸다. 아이가 물로 떨어지는 몇 초 동안, 모든 것은 잠시 숨을 멈추었다. 바람도 공기도 나뭇잎의 흔들림까지. 이윽고 '풍덩' 하는 소리와 함께 세상은 다시 깨어났다. 박수 소리가 수영장을 울렸다. 나도 손뿐 아니라 마음 깊은 곳에서 박수를 보냈다.`,
        question: "밑줄 친 부분에 나타난 사람들의 태도로 알맞은 것을 고르십시오.",
        options: ["격려하고 있다", "위로하고 있다", "안도하고 있다", "원망하고 있다"],
        correctAnswer: 0, // 격려하고 있다
        score: 2,
        instruction: "※ [42～43] 다음을 읽고 물음에 답하십시오."
    },
    {
        id: 43,
        number: 43,
        question: "이 글의 내용과 같은 것을 고르십시오.",
        options: [
            "아이가 올라간 다이빙대는 어린이 전용으로 만들어졌다.",
            "아이가 뛰어내려 물속으로 들어가자 사람들이 박수를 쳤다.",
            "방송을 통해 아이의 부모가 아이에게 내려오라고 소리쳤다.",
            "아이의 부모는 관리자에게 아이를 데려와 달라고 부탁했다."
        ],
        correctAnswer: 1, // 아이가 뛰어내려...
        score: 2
    },
    // --- [44~45] 分组阅读 ---
    {
        id: 44,
        number: 44,
        groupCount: 2,
        passage: "환경부는 '온실가스 배출권 거래제'의 시행을 앞두고 향후 3년간 온실가스 총량을 정해 업종별로 할당한다는 계획을 발표했다. 이 제도는 지구온난화의 원인인 온실가스를 줄이기 위한 것으로 업체별로 일정한 배출량을 정해 놓고 기준보다 많거나 모자라는 경우 배출권을 사고팔 수 있게 하는 제도이다. 그런데 기업의 성장률을 고려하지 않고 할당량을 정하는 방식에 대해 문제가 있다는 지적이 있다. (    ) 기업은 배출권을 구입해야 하는데 경영 악화로 공장을 가동하지 않는 기업은 도리어 배출권 판매 이익을 취할 수 있기 때문이다. 새 제도의 정착을 위해 모두가 납득할 수 있는 합리적인 시행 방안이 마련되어야 할 것이다.",
        question: "이 글의 주제로 알맞은 것을 고르십시오.",
        options: [
            "기업이 동의하지 않는 제도의 시행은 지양해야 한다.",
            "배출권 할당은 기업의 사정에 따라 조정되어야 한다.",
            "배출권 할당은 의도적인 거래를 염두에 두어야 한다.",
            "현실성을 고려한 환경 보호 대책이 마련되어야 한다."
        ],
        correctAnswer: 3, // 현실성을 고려한 환경 보호 대책이 마련되어야 한다
        score: 2,
        instruction: "※ [44～45] 다음을 읽고 물음에 답하십시오."
    },
    {
        id: 45,
        number: 45,
        question: "(    )에 들어갈 내용으로 알맞은 것을 고르십시오.",
        options: [
            "배출량이 할당된 양에 못 미친",
            "온실가스 총량을 신고하지 않은",
            "매출이 늘어 공장 가동률이 높아진",
            "경영진의 배출량 감소 의지가 강한"
        ],
        correctAnswer: 2, // 매출이 늘어 공장 가동률이 높아진
        score: 2
    },
    // --- [46~47] 分组阅读 (插入句子) ---
    {
        id: 46,
        number: 46,
        groupCount: 2,
        layout: "INSERT_BOX",
        passage: "만년 2위를 면하지 못하던 포털 사이트 '둠'과 모바일 서비스 시장의 떠오르는 샛별 '코코'가 합병을 결정하면서 IT 업계의 지각 변동이 예고된다. 이를 두고 재계의 예측은 양분된다. ( ㉠ ) 그 하나는 둠의 콘텐츠와 코코의 서비스 경쟁력이 결합했을 때 최상의 시너지 효과를 발휘할 것이라고 보는 입장이다. ( ㉡ ) 다른 하나는 현재보다 그 역량이 줄어들 것이라고 보는 입장이다. ( ㉢ ) 혼자서 하는 일에는 최선을 다하던 사람도 공동 작업에서는 그렇지 않을 수 있기 때문이다. ( ㉣ ) 여기에 코코의 경우 소규모 기업으로 시장 상황에 발 빠르게 대처한다는 게 강점이었는데, 몸집이 커지면 그것이 어렵게 될 것이라는 점도 이유로 들었다.",
        contextBox: "이는 합병 기업이 각자의 강점을 합친 것 이상의 역량을 발휘했을 때 가능하다.",
        question: "다음 문장이 들어가기에 가장 알맞은 곳을 고르십시오.",
        options: ["㉠", "㉡", "㉢", "㉣"],
        correctAnswer: 1, // ㉡
        score: 2,
        instruction: "※ [46～47] 다음을 읽고 물음에 답하십시오."
    },
    {
        id: 47,
        number: 47,
        question: "이 글의 내용과 같은 것을 고르십시오.",
        options: [
            "양 기업의 합병은 코코의 경영 부진에 의한 것이다.",
            "양 기업의 규모는 동종 업계에서 우열을 가리기 어렵다.",
            "코코는 그동안 신속한 업무 처리로 재계의 인정을 받아 왔다.",
            "둠과 코코의 합병에 대한 예측들은 긍정적이라는 공통점이 있다."
        ],
        correctAnswer: 2, // 코코는 그동안 신속한 업무 처리로...
        score: 2
    },
    // --- [48~50] 分组阅读 ---
    {
        id: 48,
        number: 48,
        groupCount: 3,
        passage: "인터넷 공간에서의 개인 정보 삭제에 관한 법안 제정이 뜨거운 쟁점으로 부각되고 있다. 유럽에서는 이러한 법안이 통과되었고 미국에서도 제한적으로 적용하기로 결정되었다. 우리 사회에서도 그간 피해 사례가 잘 알려져 있기 때문인지 찬성 쪽으로 공감대가 형성되어 있는 듯하다. 그러나 이는 이면에 잠재한 부정적 측면을 고려하지 않은 성급한 동조이다. 이 법안이 실행되었을 때 나타날 수 있는 부작용을 생각해 보라. 삭제된 정보가 흉악범에 관한 것이라면, 특정 기업의 부조리나 공직자의 비리를 고발한 기사라면……. 법 시행의 결과가 개인뿐만 아니라 사회, 국가의 불행으로 이어지지 않는다고 누가 자신할 수 있겠는가? 예컨대 누군가가 후속 범죄의 대상이 될 수도 있고 과거의 행적을 조작한 후보자가 선거에서 당선될 수도 있다. 개인의 권리를 존중하려는 의도가 (    ) 장치가 되어서는 안 될 것이다.",
        question: "필자가 이 글을 쓴 목적을 고르십시오.",
        options: [
            "법 제정의 공론화를 촉구하기 위해",
            "법 제정의 반대 근거를 제시하기 위해",
            "법 시행의 피해 사례를 알려 주기 위해",
            "법 시행의 적절한 시기를 제안하기 위해"
        ],
        correctAnswer: 1, // 법 제정의 반대 근거를 제시하기 위해
        score: 2,
        instruction: "※ [48～50] 다음을 읽고 물음에 답하십시오."
    },
    {
        id: 49,
        number: 49,
        question: "(    )에 들어갈 내용으로 알맞은 것을 고르십시오.",
        options: [
            "공공의 피해를 유발하는",
            "국민의 자유를 침해하는",
            "소통의 단절을 조장하는",
            "사회의 통합을 저해하는"
        ],
        correctAnswer: 0, // 공공의 피해를 유발하는
        score: 2
    },
    {
        id: 50,
        number: 50,
        question: "밑줄 친 부분에 나타난 필자의 태도로 알맞은 것을 고르십시오.",
        options: [
            "이 법으로 피해를 입은 사람들을 동정하고 있다.",
            "이 법의 제정 단계에서의 문제점을 지적하고 있다.",
            "이 법이 실패했던 해외 사례에 대해 비판하고 있다.",
            "이 법의 시행이 가져올 부작용에 대해 염려하고 있다."
        ],
        correctAnswer: 3, // 이 법의 시행이 가져올 부작용에 대해 염려하고 있다
        score: 2
    }
];

async function main() {
    console.log('Looking for exam:', EXAM_ID);

    const exam = await prisma.topikExam.findUnique({
        where: { id: EXAM_ID }
    });

    if (!exam) {
        console.error('Exam not found:', EXAM_ID);
        console.log('Available exams:');
        const exams = await prisma.topikExam.findMany({ select: { id: true, title: true } });
        exams.forEach(e => console.log(`  - ${e.id}: ${e.title}`));
        return;
    }

    console.log('Found exam:', exam.title);

    // Get existing questions
    let existingQuestions: any[] = [];
    const questionsData = exam.questions as any;

    if (questionsData && typeof questionsData === 'object' && questionsData.url) {
        console.log('Questions stored in S3, fetching...');
        try {
            const response = await fetch(questionsData.url);
            existingQuestions = await response.json();
        } catch (e) {
            console.error('Failed to fetch existing questions:', e);
            existingQuestions = [];
        }
    } else if (Array.isArray(questionsData)) {
        existingQuestions = questionsData;
    }

    console.log('Existing questions count:', existingQuestions.length);

    // Merge: keep questions 1-31, add new 32-50
    const mergedQuestions = [
        ...existingQuestions.filter((q: any) => q.id < 32),
        ...newQuestions
    ];

    console.log('Merged questions count:', mergedQuestions.length);

    // Upload to S3
    const { sendToS3 } = await import('../lib/storage');
    const key = `exams/${EXAM_ID}-${Date.now()}.json`;
    const buffer = Buffer.from(JSON.stringify(mergedQuestions), 'utf-8');

    await sendToS3(key, buffer, 'application/json');

    // Construct CDN URL
    const cdnUrl = process.env.SPACES_CDN_URL ||
        `https://${process.env.SPACES_BUCKET}.${new URL(process.env.SPACES_ENDPOINT || '').host.replace('digitaloceanspaces', 'cdn.digitaloceanspaces')}`;
    const newUrl = `${cdnUrl}/${key}`;

    console.log('Uploaded to S3:', newUrl);

    // Update database
    await prisma.topikExam.update({
        where: { id: EXAM_ID },
        data: { questions: { url: newUrl } }
    });

    console.log('Database updated!');
    console.log('Successfully added questions 32-50 to', EXAM_ID);
}

main()
    .catch(console.error)
    .finally(() => prisma.$disconnect());
